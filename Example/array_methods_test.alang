// 数组方法测试：map / filter / reduce / find / some / every / includes

println("=== 数组方法测试 (基础 + 扩展) ===");

// 测试数据
let numbers = [1, 2, 3, 4, 5];
let words = ["hello", "world", "alang", "test"];

// 1. map - 转换数组元素
println("\n== map 测试 ==");
let doubled = numbers.map([](x) { return x * 2; });
println("原数组:", numbers);
println("翻倍后:", doubled);

let upperWords = words.map([](w) { return w; }); // 简化版，实际应转大写但我们没有内置大写函数
println("单词数组:", upperWords);

// 2. filter - 过滤元素
println("\n== filter 测试 ==");
let evens = numbers.filter([](x) { return x % 2 == 0; });
println("偶数:", evens);

let longWords = words.filter([](w) { return w.len() > 4; });
println("长度>4的单词:", longWords);

// 3. reduce - 归约/累加
println("\n== reduce 测试 ==");
let sum = numbers.reduce([](acc, x) { return acc + x; }, 0);
println("数组求和:", sum);

let product = numbers.reduce([](acc, x) { return acc * x; }, 1);
println("数组乘积:", product);

// 不提供初始值
let sum2 = numbers.reduce([](acc, x) { return acc + x; });
println("无初始值求和:", sum2);

// 4. find - 查找第一个满足条件的元素
println("\n== find 测试 ==");
let firstEven = numbers.find([](x) { return x % 2 == 0; });
println("第一个偶数:", firstEven);

let firstLongWord = words.find([](w) { return w.len() >= 5; });
println("第一个长度>=5的单词:", firstLongWord);

let notFound = numbers.find([](x) { return x > 100; });
println("查找>100的数(不存在):", notFound);

// 5. some - 是否存在满足条件的元素
println("\n== some 测试 ==");
let hasEven = numbers.some([](x) { return x % 2 == 0; });
println("是否有偶数:", hasEven);

let hasLarge = numbers.some([](x) { return x > 10; });
println("是否有>10的数:", hasLarge);

// 6. every - 是否所有元素都满足条件
println("\n== every 测试 ==");
let allPositive = numbers.every([](x) { return x > 0; });
println("是否全为正数:", allPositive);

let allEven = numbers.every([](x) { return x % 2 == 0; });
println("是否全为偶数:", allEven);

// 7. includes - 是否包含某个值
println("\n== includes 测试 ==");
let has3 = numbers.includes(3);
println("是否包含3:", has3);

let has10 = numbers.includes(10);
println("是否包含10:", has10);

let hasHello = words.includes("hello");
println("是否包含'hello':", hasHello);

// 8. 链式调用示例
println("\n== 链式调用 ==");
let result = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    .filter([](x) { return x % 2 == 0; })
    .map([](x) { return x * x; })
    .reduce([](acc, x) { return acc + x; }, 0);
println("1-10中偶数的平方和:", result);

// 9. 带索引参数的回调
println("\n== 带索引参数 ==");
let indexed = numbers.map([](val, idx) { return val + idx; });
println("值+索引:", indexed);

// 10. 复杂对象数组
println("\n== 对象数组操作 ==");
let users = [
    {name: "Alice", age: 25},
    {name: "Bob", age: 30},
    {name: "Charlie", age: 35}
];

let names = users.map([](u) { return u.name; });
println("用户名列表:", names);

let adults = users.filter([](u) { return u.age >= 30; });
println("成年用户:", adults);

// 11. pop - 移除末尾元素
println("\n== pop 测试 ==");
let pArr = [1, 2, 3];
let popped = pArr.pop();
println("pop返回值:", popped);
println("pop后数组:", pArr);

// 12. shift - 移除头部元素
println("\n== shift 测试 ==");
let sArr = [1, 2, 3];
let shifted = sArr.shift();
println("shift返回值:", shifted);
println("shift后数组:", sArr);

// 13. unshift - 头部添加元素
println("\n== unshift 测试 ==");
let uArr = [2, 3];
let newLen = uArr.unshift(1);
println("unshift返回值:", newLen);
println("unshift后数组:", uArr);
uArr.unshift(0, -1); // 多参数测试
println("unshift多参数后:", uArr);

// 14. splice - 切片修改
println("\n== splice 测试 ==");
let spArr = [1, 2, 3, 4, 5];
// 从索引1开始删除2个元素
let removed = spArr.splice(1, 2);
println("splice删除元素:", removed);
println("splice后数组:", spArr);
// 插入元素
spArr.splice(1, 0, 8, 9);
println("splice插入后:", spArr);

// 15. sort - 排序
println("\n== sort 测试 ==");
let sortArr = [3, 1, 4, 1, 5, 9, 2, 6];
sortArr.sort(); // 默认排序
println("默认排序:", sortArr);
// 自定义排序 (降序)
sortArr.sort([](a, b) { return b - a; }); // 假设返回正数表示 b > a
println("降序排序:", sortArr);

// 16. reverse - 反转
println("\n== reverse 测试 ==");
let revArr = [1, 2, 3, 4, 5];
revArr.reverse();
println("反转后:", revArr);

// 17. indexOf - 查找索引
println("\n== indexOf 测试 ==");
let idxArr = [10, 20, 30, 40, 20];
println("20的索引:", idxArr.indexOf(20));
println("20从索引2开始找:", idxArr.indexOf(20, 2));
println("50的索引:", idxArr.indexOf(50));

// 18. join - 连接成字符串
println("\n== join 测试 ==");
let joinArr = ["a", "b", "c"];
println("默认join:", joinArr.join()); // 默认逗号? 需确认实现，看代码似乎默认无分隔符或空字符串?
// 查看C++代码: if (!args.empty()) delim=toString(args[0]); else delim=""; 
// 实际上C++代码里默认是空字符串 ""。
println("join('-'):", joinArr.join("-"));

// 19. slice - 切片
println("\n== slice 测试 ==");
let slArr = [1, 2, 3, 4, 5];
println("slice(1, 3):", slArr.slice(1, 3));
println("slice(2):", slArr.slice(2));
println("slice(-2):", slArr.slice(-2)); // 负数索引支持测试

println("\n=== 数组方法测试完成 ===");
